<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Requirements Diff Tool</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Inter -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #f0f4f8; /* Light background */
            display: flex;
            justify-content: center;
            align-items: flex-start; /* Align to top */
            min-height: 100vh;
            padding: 2rem 1rem;
        }
        .container {
            background-color: #ffffff;
            border-radius: 0.75rem; /* rounded-xl */
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); /* shadow-xl */
            padding: 2.5rem; /* p-10 */
            max-width: 90%; /* Responsive width */
            width: 1024px; /* lg:w-3/4 on large screens, or max width */
            display: flex;
            flex-direction: column;
            gap: 1.5rem; /* space-y-6 */
        }
        textarea {
            min-height: 200px;
            resize: vertical;
        }
        /* Custom highlight styles */
        /* Removed .text-green-highlight CSS class as styling will be inline */
        .text-strikethrough-default { /* Renamed class for clarity */
            text-decoration: line-through;
            /* Ensure no background property here */
        }
        .message-box {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background-color: #333;
            color: white;
            padding: 10px 20px;
            border-radius: 5px;
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
            z-index: 1000;
        }
        .message-box.show {
            opacity: 1;
        }
    </style>
</head>
<body class="bg-gray-100 p-8">
    <div class="container mx-auto p-8 bg-white rounded-xl shadow-lg flex flex-col items-center">
        <h1 class="text-4xl font-extrabold text-gray-900 mb-6 text-center">Requirements Diff Tool</h1>

        <div class="w-full grid grid-cols-2 gap-6 mb-8">
            <div>
                <label for="originalText" class="block text-lg font-medium text-gray-700 mb-2">Current requirements (copy from the site):</label>
                <textarea id="originalText"
                          class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out text-gray-800"
                          placeholder="Paste your original text here..."></textarea>
            </div>
            <div>
                <label for="newText" class="block text-lg font-medium text-gray-700 mb-2">Preview requirements (copy from the proposal):</label>
                <textarea id="newText"
                          class="w-full p-4 border border-gray-300 rounded-lg shadow-sm focus:ring-blue-500 focus:border-blue-500 transition duration-150 ease-in-out text-gray-800"
                          placeholder="Paste the new or modified text here..."></textarea>
            </div>
        </div>

        <div class="flex flex-col sm:flex-row gap-4 mb-8">
            <button id="compareButton"
                    class="px-8 py-4 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 transition duration-300 ease-in-out transform hover:scale-105">
                Compare Texts
            </button>
            <button id="copyDiffButton"
                    class="px-8 py-4 bg-gray-600 text-white font-semibold rounded-lg shadow-md hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-gray-500 focus:ring-offset-2 transition duration-300 ease-in-out transform hover:scale-105">
                Copy Diff
            </button>
        </div>

        <div id="outputDiff" class="w-full p-6 bg-gray-50 border border-gray-200 rounded-lg shadow-inner min-h-[150px] text-gray-800 leading-relaxed text-lg">
            <p class="text-center text-gray-500">Your comparison results will appear here.</p>
        </div>
    </div>

    <div id="messageBox" class="message-box"></div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const originalTextarea = document.getElementById('originalText');
            const newTextarea = document.getElementById('newText');
            const compareButton = document.getElementById('compareButton');
            const copyDiffButton = document.getElementById('copyDiffButton');
            const outputDiffDiv = document.getElementById('outputDiff');
            const messageBox = document.getElementById('messageBox');

            // Set some initial placeholder text for demonstration
            originalTextarea.value = `This is the original text.
It has a few lines.
Some words are removed.
And some lines might change.
End of original.`;

            newTextarea.value = `This is the modified text.
It has several lines.
New words are added.
And some lines might change significantly.
A brand new line.
End of modified.`;

            compareButton.addEventListener('click', () => {
                const originalText = originalTextarea.value;
                const newText = newTextarea.value;
                const diffHtml = generateDiffHtml(originalText, newText);
                outputDiffDiv.innerHTML = diffHtml || '<p class="text-center text-gray-500">No differences found, or texts are empty.</p>';
            });

            copyDiffButton.addEventListener('click', () => {
                // Get the HTML content from the diff output
                const diffHtmlContent = outputDiffDiv.innerHTML;

                // Create a temporary, hidden div to hold the HTML content
                const tempDiv = document.createElement('div');
                tempDiv.innerHTML = diffHtmlContent;
                tempDiv.style.position = 'absolute';
                tempDiv.style.left = '-9999px'; // Move it off-screen
                document.body.appendChild(tempDiv);

                // Select the content of the temporary div
                const range = document.createRange();
                range.selectNodeContents(tempDiv);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);

                try {
                    // Execute the copy command
                    document.execCommand('copy');
                    showMessage('Diff text with formatting copied to clipboard!');
                } catch (err) {
                    console.error('Failed to copy formatted text:', err);
                    showMessage('Failed to copy formatted text. Please try again or copy manually.');
                } finally {
                    // Clean up the selection and remove the temporary div
                    selection.removeAllRanges();
                    document.body.removeChild(tempDiv);
                }
            });

            /**
             * Displays a temporary message box.
             * @param {string} message The message to display.
             */
            function showMessage(message) {
                messageBox.textContent = message;
                messageBox.classList.add('show');
                setTimeout(() => {
                    messageBox.classList.remove('show');
                }, 3000); // Message disappears after 3 seconds
            }

            /**
             * Generates HTML highlighting differences between two texts using an LCS-based word/punctuation diff.
             * New content is highlighted in green, removed content is struck through.
             * @param {string} originalText
             * @param {string} newText
             * @returns {string} HTML string with highlighted differences.
             */
            function generateDiffHtml(originalText, newText) {
                // Tokenizer that splits text into words, punctuation, and individual whitespace characters (including newlines)
                const tokenize = (text) => {
                    // Regex to split by:
                    // 1. Groups of word characters (\w+)
                    // 2. Individual non-word, non-whitespace characters ([^\w\s]) - captures punctuation
                    // 3. Individual whitespace characters (\s) - captures ' ', '\n', '\t'
                    // Wrapping them in parentheses ensures `split` includes them in the result.
                    return text.split(/(\w+|[^\w\s]|\s)/).filter(Boolean); // Filter(Boolean) removes empty strings
                };

                const originalTokens = tokenize(originalText);
                const newTokens = tokenize(newText);

                const m = originalTokens.length;
                const n = newTokens.length;

                // Create a 2D array for dynamic programming table (LCS lengths)
                const dp = Array(m + 1).fill(null).map(() => Array(n + 1).fill(0));

                // Fill the dp table
                for (let i = 1; i <= m; i++) {
                    for (let j = 1; j <= n; j++) {
                        if (originalTokens[i - 1] === newTokens[j - 1]) {
                            dp[i][j] = dp[i - 1][j - 1] + 1;
                        } else {
                            dp[i][j] = Math.max(dp[i - 1][j], dp[i][j - 1]);
                        }
                    }
                }

                // Reconstruct the diff by backtracking through the dp table
                let htmlResult = [];
                let i = m;
                let j = n;

                while (i > 0 || j > 0) {
                    if (i > 0 && j > 0 && originalTokens[i - 1] === newTokens[j - 1]) {
                        // Common token: add as is (no span needed)
                        if (originalTokens[i - 1] === '\n') {
                            htmlResult.unshift('<br>');
                        } else {
                            htmlResult.unshift(originalTokens[i - 1]);
                        }
                        i--;
                        j--;
                    } else if (i > 0 && (j === 0 || dp[i - 1][j] >= dp[i][j - 1])) {
                        // Token removed from originalText (deletion) - Prioritize this path to ensure it's unshifted earlier
                        // So it appears after newly added content in the final string.
                        if (originalTokens[i - 1] === '\n') {
                            htmlResult.unshift('<br>');
                        } else {
                            // Apply background-color inline to override any potential default styling from Google Docs
                            htmlResult.unshift(`<span class="text-strikethrough-default" style="background-color: transparent;">${originalTokens[i - 1]}</span>`);
                        }
                        i--;
                    } else if (j > 0 && (i === 0 || dp[i - 1][j] < dp[i][j - 1])) {
                        // Token added in newText (insertion) - This will be unshifted later, appearing earlier in the string.
                        if (newTokens[j - 1] === '\n') {
                            htmlResult.unshift('<br>');
                        } else {
                             // Apply forest green background color inline for new content
                             htmlResult.unshift(`<span style="background-color: #d9ead3; padding: 0 2px; border-radius: 0.25rem;">${newTokens[j - 1]}</span>`);
                        }
                        j--;
                    }
                }

                return htmlResult.join('');
            }
        });
    </script>
</body>
</html>
```
